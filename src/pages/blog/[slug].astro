---
import ArticleBody from '@/components/ArticleBody'
import ArticleHeader from '@/components/ArticleHeader'
import PrevNextNavigation from '@/components/PrevNextNavigation'
import postList from '@/data/posts.json'
import type { PostList } from '@/integrations/getPostList'
import Layout from '@/layouts/Layout.astro'
import { getBlog } from '@/libs/microcms'

// import dayjs from 'dayjs'

export const getStaticPaths = async () => {
  const posts = postList.filter(
    (post) => post.postType === 'normal',
  ) as PostList
  return posts.map((post) => ({
    params: { slug: post.id },
  }))
}

/**
 * 記事取得
 */
const postID = String(Astro.params.slug)
const post = await getBlog(postID)

/**
 * 公開日
 */
// const published = dayjs(post.date).format('MMM D, YYYY')

/**
 * 前後記事情報取得
 */
const [prevPost, nextPost] = (() => {
  const posts = postList as PostList
  const postIndex = posts.findIndex(
    (post) => post.postType === 'normal' && post.id === postID,
  )
  return [posts[postIndex - 1], posts[postIndex + 1]]
})()
---

<Layout title="Welcome to Astro.">
  <article>
    <ArticleHeader
      title={post.title}
      date={post.date}
      className={'section'}
      thumbnail={post.thumbnail}
    />
    <ArticleBody
      html={post.content || post.rawContent || ''}
      className={'section'}
    />
  </article>
  <PrevNextNavigation
    className={'section navigation'}
    next={nextPost}
    previous={prevPost}
    path="/blog"
  />
</Layout>

<style>
  .navigation {
    translate: 0 -50%;
  }
</style>
