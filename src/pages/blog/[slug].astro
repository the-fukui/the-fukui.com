---
import ArticleBody from '@/components/ArticleBody'
import ArticleHeader from '@/components/ArticleHeader'
import ArticleNavigation from '@/components/ArticleNavigation'
import postList from '@/data/posts.json'
import type { PostList } from '@/integrations/getPostList'
import Layout from '@/layouts/Layout.astro'
import { getBlog } from '@/libs/microcms'

import { renderPicture } from 'astro-imagetools/api'

// import dayjs from 'dayjs'

export const getStaticPaths = async () => {
  const posts = postList.filter(
    (post) => post.postType === 'normal',
  ) as PostList
  return posts.map((post) => ({
    params: { slug: post.id },
  }))
}

/**
 * 記事取得
 */
const postID = String(Astro.params.slug)
const post = await getBlog(postID)

/**
 * サムネイル
 */
const thumbnail = await renderPicture({
  src: post.thumbnail.url,
  alt: '',
  w: 880 * 2,
  h: (880 * 2) / 1.618,
})

/**
 * 公開日
 */
// const published = dayjs(post.date).format('MMM D, YYYY')

/**
 * 前後記事情報取得
 */
const [prevPost, nextPost] = (() => {
  const posts = postList as PostList
  const postIndex = posts.findIndex(
    (post) => post.postType === 'normal' && post.id === postID,
  )
  return [posts[postIndex - 1], posts[postIndex + 1]]
})()
---

<Layout title="Welcome to Astro.">
  <article>
    <ArticleHeader
      title={post.title}
      date={post.date}
      thumbnail={thumbnail.style + thumbnail.picture}
      className={'section'}
    />
    <ArticleBody
      html={post.content || post.rawContent || ''}
      className={'section'}
    />
  </article>
  <ArticleNavigation
    className={'section navigation'}
    nextPost={nextPost}
    previousPost={prevPost}
  />
</Layout>

<style>
  .navigation {
    translate: 0 -50%;
  }
</style>
