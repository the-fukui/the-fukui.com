---
import PortfolioBody from '@/components/PortfolioBody'
import PortfolioDetail from '@/components/PortfolioDetail'
import PortfolioHeader from '@/components/PortfolioHeader'
import PrevNextNavigation from '@/components/PrevNextNavigation'
import Layout from '@/layouts/Layout.astro'
import { getPortfolio, getPortfolioList } from '@/libs/microcms'

import type { GetStaticPaths } from 'astro'

export const getStaticPaths: GetStaticPaths = async () => {
  const portfolios = await getPortfolioList()
  return portfolios.map((portfolio) => ({
    params: {
      slug: portfolio.id,
    },
  }))
}

/**
 * Portfolio取得
 */
const portfolioID = String(Astro.params.slug)
const portfolio = await getPortfolio(portfolioID)

/**
 * 前後ページ情報取得
 */
const [prevPage, nextPage] = await getPortfolioList().then((portfolios) => {
  const index = portfolios.findIndex(
    (portfolio) => portfolio.id === portfolioID,
  )
  return [portfolios[index - 1], portfolios[index + 1]]
})
---

<Layout title="Welcome to Astro.">
  <article>
    <PortfolioHeader {...portfolio} className={'section'} />
    <PortfolioBody {...portfolio} className={'section'} />
    <PortfolioDetail {...portfolio} className={'section detail'} />
  </article>
  <aside>
    <PrevNextNavigation
      previous={prevPage}
      next={nextPage}
      path="/portfolio"
      className={'section prev-next'}
    />
  </aside>
</Layout>

<style lang="scss">
  .detail {
    max-width: calc($pc-width - 30px);
    margin-top: 90px;
  }

  .prev-next {
    margin-top: 60px;
  }
</style>
